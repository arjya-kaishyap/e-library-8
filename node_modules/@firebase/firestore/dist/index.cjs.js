"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var LogLevel,firebase=_interopDefault(require("@firebase/app")),tslib=require("tslib"),logger=require("@firebase/logger"),util=require("@firebase/util"),component=require("@firebase/component"),webchannelWrapper=require("@firebase/webchannel-wrapper"),SDK_VERSION=firebase.SDK_VERSION,__PRIVATE_logClient=new logger.Logger("@firebase/firestore");function __PRIVATE_getLogLevel(){return __PRIVATE_logClient.logLevel===logger.LogLevel.DEBUG?LogLevel.DEBUG:__PRIVATE_logClient.logLevel===logger.LogLevel.SILENT?LogLevel.SILENT:LogLevel.ERROR}function setLogLevel(t){switch(t){case LogLevel.DEBUG:__PRIVATE_logClient.logLevel=logger.LogLevel.DEBUG;break;case LogLevel.ERROR:__PRIVATE_logClient.logLevel=logger.LogLevel.ERROR;break;case LogLevel.SILENT:__PRIVATE_logClient.logLevel=logger.LogLevel.SILENT;break;default:__PRIVATE_logClient.error("Firestore ("+SDK_VERSION+"): Invalid value passed to `setLogLevel`")}}function debug(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(__PRIVATE_logClient.logLevel<=logger.LogLevel.DEBUG){var i=n.map(__PRIVATE_argToString);__PRIVATE_logClient.debug.apply(__PRIVATE_logClient,tslib.__spreadArrays(["Firestore ("+SDK_VERSION+") ["+t+"]: "+e],i))}}function error(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(__PRIVATE_logClient.logLevel<=logger.LogLevel.ERROR){var r=e.map(__PRIVATE_argToString);__PRIVATE_logClient.error.apply(__PRIVATE_logClient,tslib.__spreadArrays(["Firestore ("+SDK_VERSION+"): "+t],r))}}function __PRIVATE_argToString(t){if("string"==typeof t)return t;var e=__PRIVATE_PlatformSupport.t();try{return e.i(t)}catch(e){return t}}function fail(t){var e="FIRESTORE ("+SDK_VERSION+") INTERNAL ASSERTION FAILED: "+t;throw error(e),new Error(e)}function assert(t,e){t||fail(e)}!function(t){t[t.DEBUG=0]="DEBUG",t[t.ERROR=1]="ERROR",t[t.SILENT=2]="SILENT"}(LogLevel||(LogLevel={}));var __PRIVATE_AutoId=function(){function t(){}return t.s=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return assert(20===e.length,"Invalid auto ID: "+e),e},t}();function __PRIVATE_primitiveComparator(t,e){return t<e?-1:t>e?1:0}function equals(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}function __PRIVATE_arrayEquals(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function __PRIVATE_immediateSuccessor(t){return t+"\0"}var __PRIVATE_OnlineState,__PRIVATE_OnlineStateSource,__PRIVATE_DatabaseInfo=function(t,e,n,r,i){this.o=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},__PRIVATE_DEFAULT_DATABASE_NAME="(default)",__PRIVATE_DatabaseId=function(){function t(t,e){this.projectId=t,this.database=e||__PRIVATE_DEFAULT_DATABASE_NAME}return Object.defineProperty(t.prototype,"u",{get:function(){return this.database===__PRIVATE_DEFAULT_DATABASE_NAME},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype._=function(t){return __PRIVATE_primitiveComparator(this.projectId,t.projectId)||__PRIVATE_primitiveComparator(this.database,t.database)},t}();!function(t){t[t.h=0]="__PRIVATE_Unknown",t[t.l=1]="__PRIVATE_Online",t[t.T=2]="__PRIVATE_Offline"}(__PRIVATE_OnlineState||(__PRIVATE_OnlineState={})),function(t){t[t.P=0]="__PRIVATE_RemoteStore",t[t.A=1]="__PRIVATE_SharedClientState"}(__PRIVATE_OnlineStateSource||(__PRIVATE_OnlineStateSource={}));var User=function(){function t(t){this.uid=t}return t.prototype.R=function(){return null!=this.uid},t.prototype.I=function(){return this.R()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.V=new t("google-credentials-uid"),t.m=new t("first-party-uid"),t}(),Code={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},FirestoreError=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return tslib.__extends(e,t),e}(Error),__PRIVATE_OAuthToken=function(t,e){this.user=e,this.type="OAuth",this.v={},this.v.Authorization="Bearer "+t},__PRIVATE_EmptyCredentialsProvider=function(){function t(){this.p=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.g=function(){},t.prototype.S=function(t){assert(!this.p,"Can only call setChangeListener() once."),this.p=t,t(User.UNAUTHENTICATED)},t.prototype.D=function(){assert(null!==this.p,"removeChangeListener() when no listener registered"),this.p=null},t}(),__PRIVATE_FirebaseCredentialsProvider=function(){function t(t){var e=this;this.C=null,this.currentUser=User.UNAUTHENTICATED,this.O=!1,this.F=0,this.p=null,this.forceRefresh=!1,this.C=function(){e.F++,e.currentUser=e.N(),e.O=!0,e.p&&e.p(e.currentUser)},this.F=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.C):(this.C(null),t.get().then((function(t){e.auth=t,e.C&&e.auth.addAuthTokenListener(e.C)}),(function(){})))}return t.prototype.getToken=function(){var t=this;assert(null!=this.C,"getToken cannot be called after listener removed.");var e=this.F,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){if(t.F!==e)throw new FirestoreError(Code.ABORTED,"getToken aborted due to token change.");return n?(assert("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new __PRIVATE_OAuthToken(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.g=function(){this.forceRefresh=!0},t.prototype.S=function(t){assert(!this.p,"Can only call setChangeListener() once."),this.p=t,this.O&&t(this.currentUser)},t.prototype.D=function(){assert(null!=this.C,"removeChangeListener() called twice"),assert(null!==this.p,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.C),this.C=null,this.p=null},t.prototype.N=function(){var t=this.auth&&this.auth.getUid();return assert(null===t||"string"==typeof t,"Received invalid UID: "+t),new User(t)},t}(),__PRIVATE_FirstPartyToken=function(){function t(t,e){this.M=t,this.L=e,this.type="FirstParty",this.user=User.m}return Object.defineProperty(t.prototype,"v",{get:function(){var t={"X-Goog-AuthUser":this.L},e=this.M.auth.G([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),__PRIVATE_FirstPartyCredentialsProvider=function(){function t(t,e){this.M=t,this.L=e}return t.prototype.getToken=function(){return Promise.resolve(new __PRIVATE_FirstPartyToken(this.M,this.L))},t.prototype.S=function(t){t(User.m)},t.prototype.D=function(){},t.prototype.g=function(){},t}();function __PRIVATE_makeCredentialsProvider(t){if(!t)return new __PRIVATE_EmptyCredentialsProvider;switch(t.type){case"gapi":var e=t.B;return assert(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new __PRIVATE_FirstPartyCredentialsProvider(e,t.L||"0");case"provider":return t.B;default:throw new FirestoreError(Code.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}function contains(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function __PRIVATE_defaulted(t,e){return void 0!==t?t:e}function __PRIVATE_forEachNumber(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function values(t){var e=[];return forEach(t,(function(t,n){return e.push(n)})),e}function forEach(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function __PRIVATE_isEmpty(t){for(var e in assert(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function __PRIVATE_shallowCopy(t){assert(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function __PRIVATE_validateNoArgs(t,e){if(0!==e.length)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+__PRIVATE_formatPlural(e.length,"argument")+".")}function __PRIVATE_validateExactNumberOfArgs(t,e,n){if(e.length!==n)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+t+"() requires "+__PRIVATE_formatPlural(n,"argument")+", but was called with "+__PRIVATE_formatPlural(e.length,"argument")+".")}function __PRIVATE_validateAtLeastNumberOfArgs(t,e,n){if(e.length<n)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+t+"() requires at least "+__PRIVATE_formatPlural(n,"argument")+", but was called with "+__PRIVATE_formatPlural(e.length,"argument")+".")}function __PRIVATE_validateBetweenNumberOfArgs(t,e,n,r){if(e.length<n||e.length>r)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+__PRIVATE_formatPlural(e.length,"argument")+".")}function __PRIVATE_validateNamedArrayAtLeastNumberOfElements(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+__PRIVATE_formatPlural(r,"element")+".")}function __PRIVATE_validateArgType(t,e,n,r){__PRIVATE_validateType(t,e,__PRIVATE_ordinal(n)+" argument",r)}function __PRIVATE_validateOptionalArgType(t,e,n,r){void 0!==r&&__PRIVATE_validateArgType(t,e,n,r)}function __PRIVATE_validateNamedType(t,e,n,r){__PRIVATE_validateType(t,e,n+" option",r)}function __PRIVATE_validateNamedOptionalType(t,e,n,r){void 0!==r&&__PRIVATE_validateNamedType(t,e,n,r)}function __PRIVATE_validateArrayElements(t,e,n,r,i){if(!(r instanceof Array))throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+__PRIVATE_valueDescription(r));for(var s=0;s<r.length;++s)if(!i(r[s]))throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+s+" was: "+__PRIVATE_valueDescription(r[s]))}function __PRIVATE_validateOptionalArrayElements(t,e,n,r,i){void 0!==r&&__PRIVATE_validateArrayElements(t,e,n,r,i)}function __PRIVATE_validateNamedPropertyEquals(t,e,n,r,i){for(var s=[],o=0,u=i;o<u.length;o++){var a=u[o];if(a===r)return;s.push(__PRIVATE_valueDescription(a))}var _=__PRIVATE_valueDescription(r);throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid value "+_+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+s.join(", "))}function __PRIVATE_validateNamedOptionalPropertyEquals(t,e,n,r,i){void 0!==r&&__PRIVATE_validateNamedPropertyEquals(t,e,n,r,i)}function __PRIVATE_validateStringEnum(t,e,n,r){if(!e.some((function(t){return t===r})))throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid value "+__PRIVATE_valueDescription(r)+" provided to function "+t+"() for its "+__PRIVATE_ordinal(n)+" argument. Acceptable values: "+e.join(", "))}function __PRIVATE_validateType(t,e,n,r){if(!("object"===e?__PRIVATE_isPlainObject(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=__PRIVATE_valueDescription(r);throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function __PRIVATE_isPlainObject(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function __PRIVATE_valueDescription(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=__PRIVATE_tryGetCustomObjectType(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":fail("Unknown wrong type: "+typeof t)}function __PRIVATE_tryGetCustomObjectType(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}function __PRIVATE_validateDefined(t,e,n){if(void 0===n)throw new FirestoreError(Code.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+__PRIVATE_ordinal(e)+" argument, but it was undefined.")}function __PRIVATE_validateOptionNames(t,e,n){forEach(e,(function(e,r){if(n.indexOf(e)<0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function __PRIVATE_invalidClassError(t,e,n,r){var i=__PRIVATE_valueDescription(r);return new FirestoreError(Code.INVALID_ARGUMENT,"Function "+t+"() requires its "+__PRIVATE_ordinal(n)+" argument to be a "+e+", but it was: "+i)}function __PRIVATE_validatePositiveNumber(t,e,n){if(n<=0)throw new FirestoreError(Code.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+__PRIVATE_ordinal(e)+" argument to be a positive number, but it was: "+n+".")}function __PRIVATE_ordinal(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function __PRIVATE_formatPlural(t,e){return t+" "+e+(1===t?"":"s")}var GeoPoint=function(){function t(t,e){if(__PRIVATE_validateExactNumberOfArgs("GeoPoint",arguments,2),__PRIVATE_validateArgType("GeoPoint","number",1,t),__PRIVATE_validateArgType("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new FirestoreError(Code.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new FirestoreError(Code.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.U=t,this.k=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.U},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.k},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this.U===t.U&&this.k===t.k},t.prototype.K=function(t){return __PRIVATE_primitiveComparator(this.U,t.U)||__PRIVATE_primitiveComparator(this.k,t.k)},t}(),Timestamp=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new FirestoreError(Code.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new FirestoreError(Code.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new FirestoreError(Code.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.K=function(t){return this.seconds===t.seconds?__PRIVATE_primitiveComparator(this.nanoseconds,t.nanoseconds):__PRIVATE_primitiveComparator(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),__PRIVATE_SnapshotVersion=function(){function t(t){this.timestamp=t}return t.j=function(e){var n=Math.floor(e/1e6);return new t(new Timestamp(n,e%1e6*1e3))},t.q=function(e){return new t(e)},t.W=function(){return t.MIN},t.prototype._=function(t){return this.timestamp.K(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.$=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.Y=function(){return this.timestamp},t.MIN=new t(new Timestamp(0,0)),t}(),__PRIVATE_DOCUMENT_KEY_NAME="__name__",__PRIVATE_BasePath=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&fail("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&fail("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.H(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.X(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.J=function(t){return t=void 0===t?1:t,assert(this.length>=t,"Can't call popFirst() with less segments"),this.X(this.segments,this.offset+t,this.length-t)},t.prototype.Z=function(){return assert(!this.tt(),"Can't call popLast() on empty path"),this.X(this.segments,this.offset,this.length-1)},t.prototype.et=function(){return assert(!this.tt(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.nt=function(){return this.get(this.length-1)},t.prototype.get=function(t){return assert(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.tt=function(){return 0===this.length},t.prototype.rt=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.it=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.st=function(){return this.segments.slice(this.offset,this.limit())},t.H=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),s=e.get(r);if(i<s)return-1;if(i>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),ResourcePath=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tslib.__extends(e,t),e.prototype.X=function(t,n,r){return new e(t,n,r)},e.prototype.ot=function(){return this.st().join("/")},e.prototype.toString=function(){return this.ot()},e.ut=function(t){if(t.indexOf("//")>=0)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter((function(t){return t.length>0})))},e.at=new e([]),e}(__PRIVATE_BasePath),__PRIVATE_identifierRegExp=/^[_a-zA-Z][_a-zA-Z0-9]*$/,FieldPath=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tslib.__extends(e,t),e.prototype.X=function(t,n,r){return new e(t,n,r)},e._t=function(t){return __PRIVATE_identifierRegExp.test(t)},e.prototype.ot=function(){return this.st().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e._t(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.ot()},e.prototype.ct=function(){return 1===this.length&&this.get(0)===__PRIVATE_DOCUMENT_KEY_NAME},e.ht=function(){return new e([__PRIVATE_DOCUMENT_KEY_NAME])},e.ft=function(t){for(var n=[],r="",i=0,s=function(){if(0===r.length)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},o=!1;i<t.length;){var u=t[i];if("\\"===u){if(i+1===t.length)throw new FirestoreError(Code.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new FirestoreError(Code.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===u?(o=!o,i++):"."!==u||o?(r+=u,i++):(s(),i++)}if(s(),o)throw new FirestoreError(Code.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.at=new e([]),e}(__PRIVATE_BasePath),__PRIVATE_DocumentKey=function(){function t(e){this.path=e,assert(t.lt(e),"Invalid DocumentKey with an odd number of segments: "+e.st().join("/"))}return t.prototype.dt=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===ResourcePath.H(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.H=function(t,e){return ResourcePath.H(t.path,e.path)},t.lt=function(t){return t.length%2==0},t.Tt=function(e){return new t(new ResourcePath(e.slice()))},t.Et=function(e){return new t(ResourcePath.ut(e))},t.EMPTY=new t(new ResourcePath([])),t}(),__PRIVATE_SortedMap=function(){function t(t,e){this.H=t,this.root=e||__PRIVATE_LLRBNode.EMPTY}return t.prototype.Pt=function(e,n){return new t(this.H,this.root.Pt(e,n,this.H).copy(null,null,__PRIVATE_LLRBNode.At,null,null))},t.prototype.remove=function(e){return new t(this.H,this.root.remove(e,this.H).copy(null,null,__PRIVATE_LLRBNode.At,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.tt();){var n=this.H(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.tt();){var r=this.H(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.tt=function(){return this.root.tt()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.Rt=function(){return this.root.Rt()},t.prototype.It=function(){return this.root.It()},t.prototype.Vt=function(t){return this.root.Vt(t)},t.prototype.forEach=function(t){this.Vt((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.Vt((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.vt=function(t){return this.root.vt(t)},t.prototype.pt=function(){return new __PRIVATE_SortedMapIterator(this.root,null,this.H,!1)},t.prototype.bt=function(t){return new __PRIVATE_SortedMapIterator(this.root,t,this.H,!1)},t.prototype.gt=function(){return new __PRIVATE_SortedMapIterator(this.root,null,this.H,!0)},t.prototype.wt=function(t){return new __PRIVATE_SortedMapIterator(this.root,t,this.H,!0)},t}(),__PRIVATE_SortedMapIterator=function(){function t(t,e,n,r){this.yt=r,this.St=[];for(var i=1;!t.tt();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.yt?t.left:t.right;else{if(0===i){this.St.push(t);break}this.St.push(t),t=this.yt?t.right:t.left}}return t.prototype.Dt=function(){assert(this.St.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.St.pop(),e={key:t.key,value:t.value};if(this.yt)for(t=t.left;!t.tt();)this.St.push(t),t=t.right;else for(t=t.right;!t.tt();)this.St.push(t),t=t.left;return e},t.prototype.Ct=function(){return this.St.length>0},t.prototype.Ot=function(){if(0===this.St.length)return null;var t=this.St[this.St.length-1];return{key:t.key,value:t.value}},t}(),__PRIVATE_LLRBNode=function(){function t(e,n,r,i,s){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=s?s:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,s){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)},t.prototype.tt=function(){return!1},t.prototype.Vt=function(t){return this.left.Vt(t)||t(this.key,this.value)||this.right.Vt(t)},t.prototype.vt=function(t){return this.right.vt(t)||t(this.key,this.value)||this.left.vt(t)},t.prototype.min=function(){return this.left.tt()?this:this.left.min()},t.prototype.Rt=function(){return this.min().key},t.prototype.It=function(){return this.right.tt()?this.key:this.right.It()},t.prototype.Pt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.Pt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.Pt(t,e,n))).Ft()},t.prototype.Nt=function(){if(this.left.tt())return t.EMPTY;var e=this;return e.left.Mt()||e.left.left.Mt()||(e=e.Lt()),(e=e.copy(null,null,null,e.left.Nt(),null)).Ft()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.tt()||i.left.Mt()||i.left.left.Mt()||(i=i.Lt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.Mt()&&(i=i.Gt()),i.right.tt()||i.right.Mt()||i.right.left.Mt()||(i=i.Bt()),0===n(e,i.key)){if(i.right.tt())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.Nt())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.Ft()},t.prototype.Mt=function(){return this.color},t.prototype.Ft=function(){var t=this;return t.right.Mt()&&!t.left.Mt()&&(t=t.Ut()),t.left.Mt()&&t.left.left.Mt()&&(t=t.Gt()),t.left.Mt()&&t.right.Mt()&&(t=t.kt()),t},t.prototype.Lt=function(){var t=this.kt();return t.right.left.Mt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Gt())).Ut()).kt()),t},t.prototype.Bt=function(){var t=this.kt();return t.left.left.Mt()&&(t=(t=t.Gt()).kt()),t},t.prototype.Ut=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.Gt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.kt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.xt=function(){var t=this.Kt();return Math.pow(2,t)<=this.size+1},t.prototype.Kt=function(){if(this.Mt()&&this.left.Mt())throw fail("Red node has red child("+this.key+","+this.value+")");if(this.right.Mt())throw fail("Right child of ("+this.key+","+this.value+") is red");var t=this.left.Kt();if(t!==this.right.Kt())throw fail("Black depths differ");return t+(this.Mt()?0:1)},t.EMPTY=null,t.RED=!0,t.At=!1,t}(),__PRIVATE_LLRBEmptyNode=function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw fail("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw fail("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw fail("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw fail("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw fail("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.Pt=function(t,e,n){return new __PRIVATE_LLRBNode(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.tt=function(){return!0},t.prototype.Vt=function(t){return!1},t.prototype.vt=function(t){return!1},t.prototype.Rt=function(){return null},t.prototype.It=function(){return null},t.prototype.Mt=function(){return!1},t.prototype.xt=function(){return!0},t.prototype.Kt=function(){return 0},t}();__PRIVATE_LLRBNode.EMPTY=new __PRIVATE_LLRBEmptyNode;var __PRIVATE_SortedSet=function(){function t(t){this.H=t,this.data=new __PRIVATE_SortedMap(this.H)}return t.jt=function(e){var n=new t(e.H);return e.forEach((function(t){n=n.add(t)})),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.Rt()},t.prototype.last=function(){return this.data.It()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.Vt((function(e,n){return t(e),!1}))},t.prototype.qt=function(t,e){for(var n=this.data.bt(t[0]);n.Ct();){var r=n.Dt();if(this.H(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Qt=function(t,e){var n;for(n=void 0!==e?this.data.bt(e):this.data.pt();n.Ct();){if(!t(n.Dt().key))return}},t.prototype.Wt=function(t){var e=this.data.bt(t);return e.Ct()?e.Dt().key:null},t.prototype.pt=function(){return new __PRIVATE_SortedSetIterator(this.data.pt())},t.prototype.bt=function(t){return new __PRIVATE_SortedSetIterator(this.data.bt(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).Pt(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.tt=function(){return this.data.tt()},t.prototype.$t=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.pt(),r=e.data.pt();n.Ct();){var i=n.Dt().key,s=r.Dt().key;if(0!==this.H(i,s))return!1}return!0},t.prototype.st=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.H);return n.data=e,n},t}(),__PRIVATE_SortedSetIterator=function(){function t(t){this.Yt=t}return t.prototype.Dt=function(){return this.Yt.Dt().key},t.prototype.Ct=function(){return this.Yt.Ct()},t}(),__PRIVATE_ServerTimestampTransform=function(){function t(){}return t.prototype.Ht=function(t,e){return new __PRIVATE_ServerTimestampValue(e,t)},t.prototype.Xt=function(t,e){return e},t.prototype.zt=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),__PRIVATE_ArrayUnionTransformOperation=function(){function t(t){this.elements=t}return t.prototype.Ht=function(t,e){return this.apply(t)},t.prototype.Xt=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=__PRIVATE_coercedFieldValuesArray(t),n=function(t){e.find((function(e){return e.isEqual(t)}))||e.push(t)},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new ArrayValue(e)},t.prototype.zt=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&__PRIVATE_arrayEquals(e.elements,this.elements)},t}(),__PRIVATE_ArrayRemoveTransformOperation=function(){function t(t){this.elements=t}return t.prototype.Ht=function(t,e){return this.apply(t)},t.prototype.Xt=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=__PRIVATE_coercedFieldValuesArray(t),n=function(t){e=e.filter((function(e){return!e.isEqual(t)}))},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new ArrayValue(e)},t.prototype.zt=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&__PRIVATE_arrayEquals(e.elements,this.elements)},t}(),__PRIVATE_NumericIncrementTransformOperation=function(){function t(t){this.Jt=t}return t.prototype.Ht=function(t,e){var n=this.zt(t);if(n instanceof __PRIVATE_IntegerValue&&this.Jt instanceof __PRIVATE_IntegerValue){var r=n.Zt+this.Jt.Zt;return new __PRIVATE_IntegerValue(r)}r=n.Zt+this.Jt.Zt;return new __PRIVATE_DoubleValue(r)},t.prototype.Xt=function(t,e){return assert(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},t.prototype.zt=function(t){return t instanceof __PRIVATE_NumberValue?t:new __PRIVATE_IntegerValue(0)},t.prototype.isEqual=function(e){return e instanceof t&&this.Jt.isEqual(e.Jt)},t}();function __PRIVATE_coercedFieldValuesArray(t){return t instanceof ArrayValue?t.Zt.slice():[]}var __PRIVATE_MutationType,__PRIVATE_FieldMask=function(){function t(t){this.fields=t}return t.te=function(e){return new t(e)},t.ee=function(e){var n=new __PRIVATE_SortedSet(FieldPath.H);return e.forEach((function(t){return n=n.add(t)})),new t(n)},t.prototype.ne=function(t){var e=!1;return this.fields.forEach((function(n){n.rt(t)&&(e=!0)})),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),FieldTransform=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),__PRIVATE_MutationResult=function(t,e){this.version=t,this.transformResults=e};!function(t){t[t.Set=0]="Set",t[t.re=1]="__PRIVATE_Patch",t[t.Transform=2]="Transform",t[t.ie=3]="__PRIVATE_Delete",t[t.Verify=4]="Verify"}(__PRIVATE_MutationType||(__PRIVATE_MutationType={}));var __PRIVATE_TypeOrder,__PRIVATE_ServerTimestampBehavior,Precondition=function(){function t(t,e){this.updateTime=t,this.exists=e,assert(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"se",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.oe=function(t){return void 0!==this.updateTime?t instanceof Document&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Document:(assert(this.se,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return equals(this.updateTime,t.updateTime)&&this.exists===t.exists},t.NONE=new t,t}(),__PRIVATE_Mutation=function(){function t(){}return t.prototype.ue=function(t){null!=t&&assert(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.ae=function(t){return t instanceof Document?t.version:__PRIVATE_SnapshotVersion.MIN},t}(),__PRIVATE_SetMutation=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i._e=r,i.type=__PRIVATE_MutationType.Set,i}return tslib.__extends(e,t),e.prototype.Xt=function(t,e){this.ue(t),assert(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Document(this.key,n,{hasCommittedMutations:!0},this.value)},e.prototype.Ht=function(t,e,n){if(this.ue(t),!this._e.oe(t))return t;var r=__PRIVATE_Mutation.ae(t);return new Document(this.key,r,{ce:!0},this.value)},e.prototype.he=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this._e.isEqual(t._e)},e}(__PRIVATE_Mutation),__PRIVATE_PatchMutation=function(t){function e(e,n,r,i){var s=t.call(this)||this;return s.key=e,s.data=n,s.fe=r,s._e=i,s.type=__PRIVATE_MutationType.re,s}return tslib.__extends(e,t),e.prototype.Xt=function(t,e){if(this.ue(t),assert(null==e.transformResults,"Transform results received by PatchMutation."),!this._e.oe(t))return new __PRIVATE_UnknownDocument(this.key,e.version);var n=this.le(t);return new Document(this.key,e.version,{hasCommittedMutations:!0},n)},e.prototype.Ht=function(t,e,n){if(this.ue(t),!this._e.oe(t))return t;var r=__PRIVATE_Mutation.ae(t),i=this.le(t);return new Document(this.key,r,{ce:!0},i)},e.prototype.he=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fe.isEqual(t.fe)&&this._e.isEqual(t._e)},e.prototype.le=function(t){var e;return e=t instanceof Document?t.data():__PRIVATE_ObjectValue.EMPTY,this.de(e)},e.prototype.de=function(t){var e=this;return this.fe.fields.forEach((function(n){if(!n.tt()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}})),t},e}(__PRIVATE_Mutation),__PRIVATE_TransformMutation=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=__PRIVATE_MutationType.Transform,r._e=Precondition.exists(!0),r}return tslib.__extends(e,t),e.prototype.Xt=function(t,e){if(this.ue(t),assert(null!=e.transformResults,"Transform results missing for TransformMutation."),!this._e.oe(t))return new __PRIVATE_UnknownDocument(this.key,e.version);var n=this.Te(t),r=this.Ee(t,e.transformResults),i=e.version,s=this.Pe(n.data(),r);return new Document(this.key,i,{hasCommittedMutations:!0},s)},e.prototype.Ht=function(t,e,n){if(this.ue(t),!this._e.oe(t))return t;var r=this.Te(t),i=this.Ae(n,t,e),s=this.Pe(r.data(),i);return new Document(this.key,r.version,{ce:!0},s)},e.prototype.he=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],s=t instanceof Document?t.field(i.field):void 0,o=i.transform.zt(s||null);null!=o&&(e=null==e?__PRIVATE_ObjectValue.EMPTY.set(i.field,o):e.set(i.field,o))}return e},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&__PRIVATE_arrayEquals(this.fieldTransforms,t.fieldTransforms)&&this._e.isEqual(t._e)},e.prototype.Te=function(t){return assert(t instanceof Document,"Unknown MaybeDocument type "+t),assert(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},e.prototype.Ee=function(t,e){var n=[];assert(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],s=i.transform,o=null;t instanceof Document&&(o=t.field(i.field)),n.push(s.Xt(o,e[r]))}return n},e.prototype.Ae=function(t,e,n){for(var r=[],i=0,s=this.fieldTransforms;i<s.length;i++){var o=s[i],u=o.transform,a=null;e instanceof Document&&(a=e.field(o.field)),null===a&&n instanceof Document&&(a=n.field(o.field)),r.push(u.Ht(a,t))}return r},e.prototype.Pe=function(t,e){assert(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(__PRIVATE_Mutation),__PRIVATE_DeleteMutation=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r._e=n,r.type=__PRIVATE_MutationType.ie,r}return tslib.__extends(e,t),e.prototype.Xt=function(t,e){return this.ue(t),assert(null==e.transformResults,"Transform results received by DeleteMutation."),new __PRIVATE_NoDocument(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.Ht=function(t,e,n){return this.ue(t),this._e.oe(t)?(t&&assert(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new __PRIVATE_NoDocument(this.key,__PRIVATE_SnapshotVersion.W())):t},e.prototype.he=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this._e.isEqual(t._e)},e}(__PRIVATE_Mutation),__PRIVATE_VerifyMutation=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r._e=n,r.type=__PRIVATE_MutationType.Verify,r}return tslib.__extends(e,t),e.prototype.Xt=function(t,e){fail("VerifyMutation should only be used in Transactions.")},e.prototype.Ht=function(t,e,n){fail("VerifyMutation should only be used in Transactions.")},e.prototype.he=function(t){fail("VerifyMutation should only be used in Transactions.")},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this._e.isEqual(t._e)},e}(__PRIVATE_Mutation);!function(t){t[t.Re=0]="__PRIVATE_NullValue",t[t.Ie=1]="__PRIVATE_BooleanValue",t[t.Ve=2]="__PRIVATE_NumberValue",t[t.me=3]="__PRIVATE_TimestampValue",t[t.ve=4]="__PRIVATE_StringValue",t[t.pe=5]="__PRIVATE_BlobValue",t[t.be=6]="__PRIVATE_RefValue",t[t.ge=7]="__PRIVATE_GeoPointValue",t[t.ArrayValue=8]="ArrayValue",t[t.we=9]="__PRIVATE_ObjectValue"}(__PRIVATE_TypeOrder||(__PRIVATE_TypeOrder={})),function(t){t[t.ye=0]="__PRIVATE_Default",t[t.Se=1]="__PRIVATE_Estimate",t[t.De=2]="__PRIVATE_Previous"}(__PRIVATE_ServerTimestampBehavior||(__PRIVATE_ServerTimestampBehavior={}));var __PRIVATE_FieldValueOptions=function(){function t(t,e){this.Ce=t,this.timestampsInSnapshots=e}return t.Oe=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(__PRIVATE_ServerTimestampBehavior.Se,n);case"previous":return new t(__PRIVATE_ServerTimestampBehavior.De,n);case"none":case void 0:return new t(__PRIVATE_ServerTimestampBehavior.ye,n);default:return fail("fromSnapshotOptions() called with invalid options.")}},t}(),FieldValue=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.Fe=function(t){return assert(this.Ne!==t.Ne,"Default compareTo should not be used for values of same type."),__PRIVATE_primitiveComparator(this.Ne,t.Ne)},t}(),__PRIVATE_NullValue=function(t){function e(){var e=t.call(this)||this;return e.Ne=__PRIVATE_TypeOrder.Re,e.Zt=null,e}return tslib.__extends(e,t),e.prototype.value=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.prototype._=function(t){return t instanceof e?0:this.Fe(t)},e.prototype.Me=function(){return 4},e.Le=new e,e}(FieldValue),__PRIVATE_BooleanValue=function(t){function e(e){var n=t.call(this)||this;return n.Zt=e,n.Ne=__PRIVATE_TypeOrder.Ie,n}return tslib.__extends(e,t),e.prototype.value=function(t){return this.Zt},e.prototype.isEqual=function(t){return t instanceof e&&this.Zt===t.Zt},e.prototype._=function(t){return t instanceof e?__PRIVATE_primitiveComparator(this,t):this.Fe(t)},e.prototype.Me=function(){return 4},e.of=function(t){return t?e.Ge:e.Be},e.Ge=new e(!0),e.Be=new e(!1),e}(FieldValue),__PRIVATE_NumberValue=function(t){function e(e){var n=t.call(this)||this;return n.Zt=e,n.Ne=__PRIVATE_TypeOrder.Ve,n}return tslib.__extends(e,t),e.prototype.value=function(t){return this.Zt},e.prototype._=function(t){return t instanceof e?__PRIVATE_numericComparator(this.Zt,t.Zt):this.Fe(t)},e.prototype.Me=function(){return 8},e}(FieldValue);function __PRIVATE_numericComparator(t,e){return t<e?-1:t>e?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}function __PRIVATE_numericEquals(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var __PRIVATE_IntegerValue=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tslib.__extends(e,t),e.prototype.isEqual=function(t){return t instanceof e&&__PRIVATE_numericEquals(this.Zt,t.Zt)},e}(__PRIVATE_NumberValue),__PRIVATE_DoubleValue=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tslib.__extends(e,t),e.prototype.isEqual=function(t){return t instanceof e&&__PRIVATE_numericEquals(this.Zt,t.Zt)},e.Ue=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(__PRIVATE_NumberValue),__PRIVATE_StringValue=function(t){function e(e){var n=t.call(this)||this;return n.Zt=e,n.Ne=__PRIVATE_TypeOrder.ve,n}return tslib.__extends(e,t),e.prototype.value=function(t){return this.Zt},e.prototype.isEqual=function(t){return t instanceof e&&this.Zt===t.Zt},e.prototype._=function(t){return t instanceof e?__PRIVATE_primitiveComparator(this.Zt,t.Zt):this.Fe(t)},e.prototype.Me=function(){return 2*this.Zt.length},e}(FieldValue),__PRIVATE_TimestampValue=function(t){function e(e){var n=t.call(this)||this;return n.Zt=e,n.Ne=__PRIVATE_TypeOrder.me,n}return tslib.__extends(e,t),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.Zt:this.Zt.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.Zt.isEqual(t.Zt)},e.prototype._=function(t){return t instanceof e?this.Zt.K(t.Zt):t instanceof __PRIVATE_ServerTimestampValue?-1:this.Fe(t)},e.prototype.Me=function(){return 16},e}(FieldValue),__PRIVATE_ServerTimestampValue=function(t){function e(e,n){var r=t.call(this)||this;return r.ke=e,r.previousValue=n,r.Ne=__PRIVATE_TypeOrder.me,r}return tslib.__extends(e,t),e.prototype.value=function(t){return t&&t.Ce===__PRIVATE_ServerTimestampBehavior.Se?new __PRIVATE_TimestampValue(this.ke).value(t):t&&t.Ce===__PRIVATE_ServerTimestampBehavior.De&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.ke.isEqual(t.ke)},e.prototype._=function(t){return t instanceof e?this.ke.K(t.ke):t instanceof __PRIVATE_TimestampValue?1:this.Fe(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.ke.toString()+">"},e.prototype.Me=function(){return 16+(this.previousValue?this.previousValue.Me():0)},e}(FieldValue),__PRIVATE_BlobValue=function(t){function e(e){var n=t.call(this)||this;return n.Zt=e,n.Ne=__PRIVATE_TypeOrder.pe,n}return tslib.__extends(e,t),e.prototype.value=function(t){return this.Zt},e.prototype.isEqual=function(t){return t instanceof e&&this.Zt.isEqual(t.Zt)},e.prototype._=function(t){return t instanceof e?this.Zt.K(t.Zt):this.Fe(t)},e.prototype.Me=function(){return this.Zt.xe()},e}(FieldValue),__PRIVATE_RefValue=function(t){function e(e,n){var r=t.call(this)||this;return r.o=e,r.key=n,r.Ne=__PRIVATE_TypeOrder.be,r}return tslib.__extends(e,t),e.prototype.value=function(t){return this.key},e.prototype.isEqual=function(t){return t instanceof e&&(this.key.isEqual(t.key)&&this.o.isEqual(t.o))},e.prototype._=function(t){if(t instanceof e){var n=this.o._(t.o);return 0!==n?n:__PRIVATE_DocumentKey.H(this.key,t.key)}return this.Fe(t)},e.prototype.Me=function(){return this.o.projectId.length+this.o.database.length+this.key.toString().length},e}(FieldValue),__PRIVATE_GeoPointValue=function(t){function e(e){var n=t.call(this)||this;return n.Zt=e,n.Ne=__PRIVATE_TypeOrder.ge,n}return tslib.__extends(e,t),e.prototype.value=function(t){return this.Zt},e.prototype.isEqual=function(t){return t instanceof e&&this.Zt.isEqual(t.Zt)},e.prototype._=function(t){return t instanceof e?this.Zt.K(t.Zt):this.Fe(t)},e.prototype.Me=function(){return 16},e}(FieldValue),__PRIVATE_ObjectValue=function(t){function e(e){var n=t.call(this)||this;return n.Zt=e,n.Ne=__PRIVATE_TypeOrder.we,n}return tslib.__extends(e,t),e.prototype.value=function(t){var e={};return this.Zt.Vt((function(n,r){e[n]=r.value(t)})),e},e.prototype.forEach=function(t){this.Zt.Vt(t)},e.prototype.isEqual=function(t){if(t instanceof e){for(var n=this.Zt.pt(),r=t.Zt.pt();n.Ct()&&r.Ct();){var i=n.Dt(),s=r.Dt();if(i.key!==s.key||!i.value.isEqual(s.value))return!1}return!n.Ct()&&!r.Ct()}return!1},e.prototype._=function(t){if(t instanceof e){for(var n=this.Zt.pt(),r=t.Zt.pt();n.Ct()&&r.Ct();){var i=n.Dt(),s=r.Dt(),o=__PRIVATE_primitiveComparator(i.key,s.key)||i.value._(s.value);if(o)return o}return __PRIVATE_primitiveComparator(n.Ct(),r.Ct())}return this.Fe(t)},e.prototype.set=function(t,n){if(assert(!t.tt(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.Ke(t.et(),n);var r=this.child(t.et());r instanceof e||(r=e.EMPTY);var i=r.set(t.J(),n);return this.Ke(t.et(),i)},e.prototype.delete=function(t){if(assert(!t.tt(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new e(this.Zt.remove(t.et()));var n=this.child(t.et());if(n instanceof e){var r=n.delete(t.J());return new e(this.Zt.Pt(t.et(),r))}return this},e.prototype.contains=function(t){return null!==this.field(t)},e.prototype.field=function(t){assert(!t.tt(),"Can't get field of empty path");var n=this;return t.forEach((function(t){n=n instanceof e?n.Zt.get(t):null})),n},e.prototype.fe=function(){var t=new __PRIVATE_SortedSet(FieldPath.H);return this.Zt.forEach((function(n,r){var i=new FieldPath([n]);if(r instanceof e){var s=r.fe().fields;s.tt()?t=t.add(i):s.forEach((function(e){t=t.add(i.child(e))}))}else t=t.add(i)})),__PRIVATE_FieldMask.te(t)},e.prototype.Me=function(){var t=0;return this.Zt.Vt((function(e,n){t+=e.length+n.Me()})),t},e.prototype.toString=function(){return this.Zt.toString()},e.prototype.child=function(t){return this.Zt.get(t)||void 0},e.prototype.Ke=function(t,n){return new e(this.Zt.Pt(t,n))},e.EMPTY=new e(new __PRIVATE_SortedMap(__PRIVATE_primitiveComparator)),e}(FieldValue),ArrayValue=function(t){function e(e){var n=t.call(this)||this;return n.Zt=e,n.Ne=__PRIVATE_TypeOrder.ArrayValue,n}return tslib.__extends(e,t),e.prototype.value=function(t){return this.Zt.map((function(e){return e.value(t)}))},e.prototype.contains=function(t){for(var e=0,n=this.Zt;e<n.length;e++){if(n[e].isEqual(t))return!0}return!1},e.prototype.forEach=function(t){this.Zt.forEach(t)},e.prototype.isEqual=function(t){if(t instanceof e){if(this.Zt.length!==t.Zt.length)return!1;for(var n=0;n<this.Zt.length;n++)if(!this.Zt[n].isEqual(t.Zt[n]))return!1;return!0}return!1},e.prototype._=function(t){if(t instanceof e){for(var n=Math.min(this.Zt.length,t.Zt.length),r=0;r<n;r++){var i=this.Zt[r]._(t.Zt[r]);if(i)return i}return __PRIVATE_primitiveComparator(this.Zt.length,t.Zt.length)}return this.Fe(t)},e.prototype.Me=function(){return this.Zt.reduce((function(t,e){return t+e.Me()}),0)},e.prototype.toString=function(){return"["+this.Zt.map((function(t){return t.toString()})).join(",")+"]"},e}(FieldValue),__PRIVATE_MaybeDocument=function(){function t(t,e){this.key=t,this.version=e}return t.je=function(t,e){return __PRIVATE_DocumentKey.H(t.key,e.key)},t}(),Document=function(t){function e(e,n,r,i,s,o){var u=t.call(this,e,n)||this;return u.qe=i,u.proto=s,u.converter=o,assert(void 0!==u.qe||void 0!==u.proto&&void 0!==u.converter,"If objectValue is not defined, proto and converter need to be set."),u.ce=!!r.ce,u.hasCommittedMutations=!!r.hasCommittedMutations,u}return tslib.__extends(e,t),e.prototype.field=function(t){if(this.qe)return this.qe.field(t);this.Qe||(this.Qe=new Map);var e=t.ot(),n=this.Qe.get(e);if(void 0===n){var r=this.We(t);n=void 0===r?null:this.converter(r),this.Qe.set(e,n)}return n},e.prototype.data=function(){var t=this;if(!this.qe){var e=__PRIVATE_ObjectValue.EMPTY;forEach(this.proto.fields||{},(function(n,r){e=e.set(new FieldPath([n]),t.converter(r))})),this.qe=e,this.Qe=void 0}return this.qe},e.prototype.value=function(){return this.data().value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.ce===t.ce&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.ce+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.ce||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.We=function(t){assert(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.et()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},e.$e=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r._(i):fail("Trying to compare documents on fields that don't exist")},e}(__PRIVATE_MaybeDocument),__PRIVATE_NoDocument=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return tslib.__extends(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(__PRIVATE_MaybeDocument),__PRIVATE_UnknownDocument=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tslib.__extends(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(__PRIVATE_MaybeDocument),__PRIVATE_NumberAsAny=Number,MIN_SAFE_INTEGER=__PRIVATE_NumberAsAny.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),MAX_SAFE_INTEGER=__PRIVATE_NumberAsAny.MAX_SAFE_INTEGER||Math.pow(2,53)-1,isInteger=__PRIVATE_NumberAsAny.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function isNullOrUndefined(t){return null==t}function isSafeInteger(t){return isInteger(t)&&t<=MAX_SAFE_INTEGER&&t>=MIN_SAFE_INTEGER}var __PRIVATE_LimitType,Target=function(){function t(t,e,n,r,i,s,o){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Ye=null}return t.prototype.canonicalId=function(){if(null===this.Ye){var t=this.path.ot();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++){t+=n[e].canonicalId(),t+=","}t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++){t+=i[r].canonicalId(),t+=","}isNullOrUndefined(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Ye=t}return this.Ye},t.prototype.toString=function(){var t=this.path.ot();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),isNullOrUndefined(this.limit)||(t+=", limit: "+this.limit),this.orderBy.length>0&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&(!!this.path.isEqual(t.path)&&(!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)))},t.prototype.He=function(){return __PRIVATE_DocumentKey.lt(this.path)&&null===this.collectionGroup&&0===this.filters.length},t}();!function(t){t.Xe="F",t.ze="L"}(__PRIVATE_LimitType||(__PRIVATE_LimitType={}));var __PRIVATE_TargetPurpose,Query=function(){function t(t,e,n,r,i,s,o,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===s&&(s=__PRIVATE_LimitType.Xe),void 0===o&&(o=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.Je=n,this.filters=r,this.limit=i,this.Ze=s,this.startAt=o,this.endAt=u,this.tn=null,this.en=null,this.startAt&&this.nn(this.startAt),this.endAt&&this.nn(this.endAt)}return t.rn=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.tn){var t=this.in(),e=this.sn();if(null!==t&&null===e)t.ct()?this.tn=[__PRIVATE_KEY_ORDERING_ASC]:this.tn=[new __PRIVATE_OrderBy(t),__PRIVATE_KEY_ORDERING_ASC];else{assert(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.tn=[];for(var n=!1,r=0,i=this.Je;r<i.length;r++){var s=i[r];this.tn.push(s),s.field.ct()&&(n=!0)}if(!n){var o=this.Je.length>0?this.Je[this.Je.length-1].dir:__PRIVATE_Direction.ASCENDING;this.tn.push(o===__PRIVATE_Direction.ASCENDING?__PRIVATE_KEY_ORDERING_ASC:__PRIVATE_KEY_ORDERING_DESC)}}}return this.tn},enumerable:!0,configurable:!0}),t.prototype.on=function(e){assert(null==this.in()||!(e instanceof FieldFilter)||!e.un()||e.field.isEqual(this.in()),"Query must only have one inequality field."),assert(!this.He(),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.Je.slice(),n,this.limit,this.Ze,this.startAt,this.endAt)},t.prototype.an=function(e){assert(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.Je.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.Ze,this.startAt,this.endAt)},t.prototype._n=function(e){return new t(this.path,this.collectionGroup,this.Je.slice(),this.filters.slice(),e,__PRIVATE_LimitType.Xe,this.startAt,this.endAt)},t.prototype.cn=function(e){return new t(this.path,this.collectionGroup,this.Je.slice(),this.filters.slice(),e,__PRIVATE_LimitType.ze,this.startAt,this.endAt)},t.prototype.hn=function(e){return new t(this.path,this.collectionGroup,this.Je.slice(),this.filters.slice(),this.limit,this.Ze,e,this.endAt)},t.prototype.fn=function(e){return new t(this.path,this.collectionGroup,this.Je.slice(),this.filters.slice(),this.limit,this.Ze,this.startAt,e)},t.prototype.ln=function(e){return new t(e,null,this.Je.slice(),this.filters.slice(),this.limit,this.Ze,this.startAt,this.endAt)},t.prototype.dn=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.Je.length||1===this.Je.length&&this.Je[0].field.ct())},t.prototype.canonicalId=function(){return this.Tn().canonicalId()+"|lt:"+this.Ze},t.prototype.toString=function(){return"Query(target="+this.Tn().toString()+"; limitType="+this.Ze+")"},t.prototype.isEqual=function(t){return this.Tn().isEqual(t.Tn())&&this.Ze===t.Ze},t.prototype.En=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var s=i[r],o=s.compare(t,e);if(0!==o)return o;n=n||s.field.ct()}return assert(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.Pn(t)&&this.An(t)&&this.Rn(t)&&this.In(t)},t.prototype.Vn=function(){return!isNullOrUndefined(this.limit)&&this.Ze===__PRIVATE_LimitType.Xe},t.prototype.mn=function(){return!isNullOrUndefined(this.limit)&&this.Ze===__PRIVATE_LimitType.ze},t.prototype.sn=function(){return this.Je.length>0?this.Je[0].field:null},t.prototype.in=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof FieldFilter&&n.un())return n.field}return null},t.prototype.vn=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof FieldFilter&&t.indexOf(r.op)>=0)return r.op}return null},t.prototype.He=function(){return this.Tn().He()},t.prototype.pn=function(){return null!==this.collectionGroup},t.prototype.Tn=function(){if(!this.en)if(this.Ze===__PRIVATE_LimitType.Xe)this.en=new Target(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===__PRIVATE_Direction.DESCENDING?__PRIVATE_Direction.ASCENDING:__PRIVATE_Direction.DESCENDING;t.push(new __PRIVATE_OrderBy(r.field,i))}var s=this.endAt?new __PRIVATE_Bound(this.endAt.position,!this.endAt.before):null,o=this.startAt?new __PRIVATE_Bound(this.startAt.position,!this.startAt.before):null;this.en=new Target(this.path,this.collectionGroup,t,this.filters,this.limit,s,o)}return this.en},t.prototype.Pn=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.dt(this.collectionGroup)&&this.path.rt(e):__PRIVATE_DocumentKey.lt(this.path)?this.path.isEqual(e):this.path.it(e)},t.prototype.An=function(t){for(var e=0,n=this.Je;e<n.length;e++){var r=n[e];if(!r.field.ct()&&null===t.field(r.field))return!1}return!0},t.prototype.Rn=function(t){for(var e=0,n=this.filters;e<n.length;e++){if(!n[e].matches(t))return!1}return!0},t.prototype.In=function(t){return!(this.startAt&&!this.startAt.bn(this.orderBy,t))&&(!this.endAt||!this.endAt.bn(this.orderBy,t))},t.prototype.nn=function(t){assert(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),Filter=function(){},__PRIVATE_Operator=function(){function t(t){this.name=t}return t.ut=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;case"in":return t.IN;case"array-contains-any":return t.ARRAY_CONTAINS_ANY;default:return fail("Unknown FieldFilter operator: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t.IN=new t("in"),t.ARRAY_CONTAINS_ANY=new t("array-contains-any"),t}(),FieldFilter=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return tslib.__extends(e,t),e.create=function(t,n,r){if(t.ct())return n===__PRIVATE_Operator.IN?(assert(r instanceof ArrayValue,"Comparing on key with IN, but filter value not an ArrayValue"),assert(r.Zt.every((function(t){return t instanceof __PRIVATE_RefValue})),"Comparing on key with IN, but an array value was not a RefValue"),new __PRIVATE_KeyFieldInFilter(t,r)):(assert(r instanceof __PRIVATE_RefValue,"Comparing on key, but filter value not a RefValue"),assert(n!==__PRIVATE_Operator.ARRAY_CONTAINS&&n!==__PRIVATE_Operator.ARRAY_CONTAINS_ANY,"'"+n.toString()+"' queries don't make sense on document keys."),new __PRIVATE_KeyFieldFilter(t,n,r));if(r.isEqual(__PRIVATE_NullValue.Le)){if(n!==__PRIVATE_Operator.EQUAL)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new e(t,n,r)}if(r.isEqual(__PRIVATE_DoubleValue.Ue)){if(n!==__PRIVATE_Operator.EQUAL)throw new FirestoreError(Code.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new e(t,n,r)}return n===__PRIVATE_Operator.ARRAY_CONTAINS?new __PRIVATE_ArrayContainsFilter(t,r):n===__PRIVATE_Operator.IN?(assert(r instanceof ArrayValue,"IN filter has invalid value: "+r.toString()),new __PRIVATE_InFilter(t,r)):n===__PRIVATE_Operator.ARRAY_CONTAINS_ANY?(assert(r instanceof ArrayValue,"ARRAY_CONTAINS_ANY filter has invalid value: "+r.toString()),new __PRIVATE_ArrayContainsAnyFilter(t,r)):new e(t,n,r)},e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.Ne===e.Ne&&this.gn(e._(this.value))},e.prototype.gn=function(t){switch(this.op){case __PRIVATE_Operator.LESS_THAN:return t<0;case __PRIVATE_Operator.LESS_THAN_OR_EQUAL:return t<=0;case __PRIVATE_Operator.EQUAL:return 0===t;case __PRIVATE_Operator.GREATER_THAN:return t>0;case __PRIVATE_Operator.GREATER_THAN_OR_EQUAL:return t>=0;default:return fail("Unknown FieldFilter operator: "+this.op)}},e.prototype.un=function(){return[__PRIVATE_Operator.LESS_THAN,__PRIVATE_Operator.LESS_THAN_OR_EQUAL,__PRIVATE_Operator.GREATER_THAN,__PRIVATE_Operator.GREATER_THAN_OR_EQUAL].indexOf(this.op)>=0},e.prototype.canonicalId=function(){return this.field.ot()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&(this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value))},e.prototype.toString=function(){return this.field.ot()+" "+this.op+" "+this.value.value()},e}(Filter),__PRIVATE_KeyFieldFilter=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tslib.__extends(e,t),e.prototype.matches=function(t){var e=this.value,n=__PRIVATE_DocumentKey.H(t.key,e.key);return this.gn(n)},e}(FieldFilter),__PRIVATE_KeyFieldInFilter=function(t){function e(e,n){var r=t.call(this,e,__PRIVATE_Operator.IN,n)||this;return r.value=n,r}return tslib.__extends(e,t),e.prototype.matches=function(t){return this.value.Zt.some((function(e){return t.key.isEqual(e.key)}))},e}(FieldFilter),__PRIVATE_ArrayContainsFilter=function(t){function e(e,n){return t.call(this,e,__PRIVATE_Operator.ARRAY_CONTAINS,n)||this}return tslib.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return e instanceof ArrayValue&&e.contains(this.value)},e}(FieldFilter),__PRIVATE_InFilter=function(t){function e(e,n){var r=t.call(this,e,__PRIVATE_Operator.IN,n)||this;return r.value=n,r}return tslib.__extends(e,t),e.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},e}(FieldFilter),__PRIVATE_ArrayContainsAnyFilter=function(t){function e(e,n){var r=t.call(this,e,__PRIVATE_Operator.ARRAY_CONTAINS_ANY,n)||this;return r.value=n,r}return tslib.__extends(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof ArrayValue&&n.Zt.some((function(t){return e.value.contains(t)}))},e}(FieldFilter),__PRIVATE_Direction=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),__PRIVATE_Bound=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++){t+=n[e].toString()}return t},t.prototype.bn=function(t,e){assert(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],s=this.position[r];if(i.field.ct())assert(s instanceof __PRIVATE_RefValue,"Bound has a non-key value where the key path is being used."),n=__PRIVATE_DocumentKey.H(s.key,e.key);else{var o=e.field(i.field);assert(null!==o,"Field should exist since document matched the orderBy already."),n=s._(o)}if(i.dir===__PRIVATE_Direction.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},t}(),__PRIVATE_OrderBy=function(){function t(t,e){this.field=t,void 0===e&&(e=__PRIVATE_Direction.ASCENDING),this.dir=e,this.wn=t.ct()}return t.prototype.compare=function(t,e){var n=this.wn?Document.je(t,e):Document.$e(this.field,t,e);switch(this.dir){case __PRIVATE_Direction.ASCENDING:return n;case __PRIVATE_Direction.DESCENDING:return-1*n;default:return fail("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.ot()+this.dir.toString()},t.prototype.toString=function(){return this.field.ot()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),__PRIVATE_KEY_ORDERING_ASC=new __PRIVATE_OrderBy(FieldPath.ht(),__PRIVATE_Direction.ASCENDING),__PRIVATE_KEY_ORDERING_DESC=new __PRIVATE_OrderBy(FieldPath.ht(),__PRIVATE_Direction.DESCENDING);!function(t){t[t.yn=0]="__PRIVATE_Listen",t[t.Sn=1]="__PRIVATE_ExistenceFilterMismatch",t[t.Dn=2]="__PRIVATE_LimboResolution"}(__PRIVATE_TargetPurpose||(__PRIVATE_TargetPurpose={}));var __PRIVATE_RpcCode,__PRIVATE_TargetData=function(){function t(t,e,n,r,i,s,o){void 0===i&&(i=__PRIVATE_SnapshotVersion.MIN),void 0===s&&(s=__PRIVATE_SnapshotVersion.MIN),void 0===o&&(o=__PRIVATE_emptyByteString()),this.target=t,this.targetId=e,this.Cn=n,this.sequenceNumber=r,this.On=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}return t.prototype.Fn=function(e){return new t(this.target,this.targetId,this.Cn,e,this.On,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.Nn=function(e,n){return new t(this.target,this.targetId,this.Cn,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.Mn=function(e){return new t(this.target,this.targetId,this.Cn,this.sequenceNumber,this.On,e,this.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.Cn===t.Cn&&this.sequenceNumber===t.sequenceNumber&&this.On.isEqual(t.On)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.target.isEqual(t.target)},t}(),ExistenceFilter=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}();function __PRIVATE_isPermanentError(t){switch(t){case Code.OK:return fail("Treated status OK as error");case Code.CANCELLED:case Code.UNKNOWN:case Code.DEADLINE_EXCEEDED:case Code.RESOURCE_EXHAUSTED:case Code.INTERNAL:case Code.UNAVAILABLE:case Code.UNAUTHENTICATED:return!1;case Code.INVALID_ARGUMENT:case Code.NOT_FOUND:case Code.ALREADY_EXISTS:case Code.PERMISSION_DENIED:case Code.FAILED_PRECONDITION:case Code.ABORTED:case Code.OUT_OF_RANGE:case Code.UNIMPLEMENTED:case Code.DATA_LOSS:return!0;default:return fail("Unknown status code: "+t)}}function __PRIVATE_isPermanentWriteError(t){return __PRIVATE_isPermanentError(t)&&t!==Code.ABORTED}function __PRIVATE_mapCodeFromRpcStatus(t){var e=__PRIVATE_RpcCode[t];if(void 0!==e)return __PRIVATE_mapCodeFromRpcCode(e)}function __PRIVATE_mapCodeFromRpcCode(t){if(void 0===t)return error("GRPC error has no .code"),Code.UNKNOWN;switch(t){case __PRIVATE_RpcCode.OK:return Code.OK;case __PRIVATE_RpcCode.CANCELLED:return Code.CANCELLED;case __PRIVATE_RpcCode.UNKNOWN:return Code.UNKNOWN;case __PRIVATE_RpcCode.DEADLINE_EXCEEDED:return Code.DEADLINE_EXCEEDED;case __PRIVATE_RpcCode.RESOURCE_EXHAUSTED:return Code.RESOURCE_EXHAUSTED;case __PRIVATE_RpcCode.INTERNAL:return Code.INTERNAL;case __PRIVATE_RpcCode.UNAVAILABLE:return Code.UNAVAILABLE;case __PRIVATE_RpcCode.UNAUTHENTICATED:return Code.UNAUTHENTICATED;case __PRIVATE_RpcCode.INVALID_ARGUMENT:return Code.INVALID_ARGUMENT;case __PRIVATE_RpcCode.NOT_FOUND:return Code.NOT_FOUND;case __PRIVATE_RpcCode.ALREADY_EXISTS:return Code.ALREADY_EXISTS;case __PRIVATE_RpcCode.PERMISSION_DENIED:return Code.PERMISSION_DENIED;case __PRIVATE_RpcCode.FAILED_PRECONDITION:return Code.FAILED_PRECONDITION;case __PRIVATE_RpcCode.ABORTED:return Code.ABORTED;case __PRIVATE_RpcCode.OUT_OF_RANGE:return Code.OUT_OF_RANGE;case __PRIVATE_RpcCode.UNIMPLEMENTED:return Code.UNIMPLEMENTED;case __PRIVATE_RpcCode.DATA_LOSS:return Code.DATA_LOSS;default:return fail("Unknown status code: "+t)}}function __PRIVATE_mapRpcCodeFromCode(t){if(void 0===t)return __PRIVATE_RpcCode.OK;switch(t){case Code.OK:return __PRIVATE_RpcCode.OK;case Code.CANCELLED:return __PRIVATE_RpcCode.CANCELLED;case Code.UNKNOWN:return __PRIVATE_RpcCode.UNKNOWN;case Code.DEADLINE_EXCEEDED:return __PRIVATE_RpcCode.DEADLINE_EXCEEDED;case Code.RESOURCE_EXHAUSTED:return __PRIVATE_RpcCode.RESOURCE_EXHAUSTED;case Code.INTERNAL:return __PRIVATE_RpcCode.INTERNAL;case Code.UNAVAILABLE:return __PRIVATE_RpcCode.UNAVAILABLE;case Code.UNAUTHENTICATED:return __PRIVATE_RpcCode.UNAUTHENTICATED;case Code.INVALID_ARGUMENT:return __PRIVATE_RpcCode.INVALID_ARGUMENT;case Code.NOT_FOUND:return __PRIVATE_RpcCode.NOT_FOUND;case Code.ALREADY_EXISTS:return __PRIVATE_RpcCode.ALREADY_EXISTS;case Code.PERMISSION_DENIED:return __PRIVATE_RpcCode.PERMISSION_DENIED;case Code.FAILED_PRECONDITION:return __PRIVATE_RpcCode.FAILED_PRECONDITION;case Code.ABORTED:return __PRIVATE_RpcCode.ABORTED;case Code.OUT_OF_RANGE:return __PRIVATE_RpcCode.OUT_OF_RANGE;case Code.UNIMPLEMENTED:return __PRIVATE_RpcCode.UNIMPLEMENTED;case Code.DATA_LOSS:return __PRIVATE_RpcCode.DATA_LOSS;default:return fail("Unknown status code: "+t)}}function __PRIVATE_mapCodeFromHttpResponseErrorStatus(t){var e=t.toLowerCase().replace("_","-");return Object.values(Code).indexOf(e)>=0?e:Code.UNKNOWN}!function(t){t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS"}(__PRIVATE_RpcCode||(__PRIVATE_RpcCode={}));var __PRIVATE_EMPTY_MAYBE_DOCUMENT_MAP=new __PRIVATE_SortedMap(__PRIVATE_DocumentKey.H);function __PRIVATE_maybeDocumentMap(){return __PRIVATE_EMPTY_MAYBE_DOCUMENT_MAP}function __PRIVATE_nullableMaybeDocumentMap(){return __PRIVATE_maybeDocumentMap()}var __PRIVATE_EMPTY_DOCUMENT_MAP=new __PRIVATE_SortedMap(__PRIVATE_DocumentKey.H);function __PRIVATE_documentMap(){return __PRIVATE_EMPTY_DOCUMENT_MAP}var __PRIVATE_EMPTY_DOCUMENT_VERSION_MAP=new __PRIVATE_SortedMap(__PRIVATE_DocumentKey.H);function __PRIVATE_documentVersionMap(){return __PRIVATE_EMPTY_DOCUMENT_VERSION_MAP}var __PRIVATE_EMPTY_DOCUMENT_KEY_SET=new __PRIVATE_SortedSet(__PRIVATE_DocumentKey.H);function __PRIVATE_documentKeySet(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=__PRIVATE_EMPTY_DOCUMENT_KEY_SET,r=0,i=t;r<i.length;r++){var s=i[r];n=n.add(s)}return n}var __PRIVATE_EMPTY_TARGET_ID_SET=new __PRIVATE_SortedSet(__PRIVATE_primitiveComparator);function __PRIVATE_targetIdSet(){return __PRIVATE_EMPTY_TARGET_ID_SET}var __PRIVATE_ChangeType,__PRIVATE_SyncState,__PRIVATE_DocumentSet=function(){function t(t){this.H=t?function(e,n){return t(e,n)||__PRIVATE_DocumentKey.H(e.key,n.key)}:function(t,e){return __PRIVATE_DocumentKey.H(t.key,e.key)},this.Ln=__PRIVATE_documentMap(),this.Gn=new __PRIVATE_SortedMap(this.H)}return t.Bn=function(e){return new t(e.H)},t.prototype.has=function(t){return null!=this.Ln.get(t)},t.prototype.get=function(t){return this.Ln.get(t)},t.prototype.first=function(){return this.Gn.Rt()},t.prototype.last=function(){return this.Gn.It()},t.prototype.tt=function(){return this.Gn.tt()},t.prototype.indexOf=function(t){var e=this.Ln.get(t);return e?this.Gn.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.Gn.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.Gn.Vt((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ln.Pt(t.key,t),e.Gn.Pt(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ln.remove(t),this.Gn.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Gn.pt(),r=e.Gn.pt();n.Ct();){var i=n.Dt().key,s=r.Dt().key;if(!i.isEqual(s))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.H=this.H,r.Ln=e,r.Gn=n,r},t}();!function(t){t[t.Un=0]="__PRIVATE_Added",t[t.kn=1]="__PRIVATE_Removed",t[t.xn=2]="__PRIVATE_Modified",t[t.Kn=3]="__PRIVATE_Metadata"}(__PRIVATE_ChangeType||(__PRIVATE_ChangeType={})),function(t){t[t.jn=0]="__PRIVATE_Local",t[t.qn=1]="__PRIVATE_Synced"}(__PRIVATE_SyncState||(__PRIVATE_SyncState={}));var __PRIVATE_WatchTargetChangeState,__PRIVATE_DocumentChangeSet=function(){function t(){this.Qn=new __PRIVATE_SortedMap(__PRIVATE_DocumentKey.H)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qn.get(e);n?t.type!==__PRIVATE_ChangeType.Un&&n.type===__PRIVATE_ChangeType.Kn?this.Qn=this.Qn.Pt(e,t):t.type===__PRIVATE_ChangeType.Kn&&n.type!==__PRIVATE_ChangeType.kn?this.Qn=this.Qn.Pt(e,{type:n.type,doc:t.doc}):t.type===__PRIVATE_ChangeType.xn&&n.type===__PRIVATE_ChangeType.xn?this.Qn=this.Qn.Pt(e,{type:__PRIVATE_ChangeType.xn,doc:t.doc}):t.type===__PRIVATE_ChangeType.xn&&n.type===__PRIVATE_ChangeType.Un?this.Qn=this.Qn.Pt(e,{type:__PRIVATE_ChangeType.Un,doc:t.doc}):t.type===__PRIVATE_ChangeType.kn&&n.type===__PRIVATE_ChangeType.Un?this.Qn=this.Qn.remove(e):t.type===__PRIVATE_ChangeType.kn&&n.type===__PRIVATE_ChangeType.xn?this.Qn=this.Qn.Pt(e,{type:__PRIVATE_ChangeType.kn,doc:n.doc}):t.type===__PRIVATE_ChangeType.Un&&n.type===__PRIVATE_ChangeType.kn?this.Qn=this.Qn.Pt(e,{type:__PRIVATE_ChangeType.xn,doc:t.doc}):fail("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.Qn=this.Qn.Pt(e,t)},t.prototype.Wn=function(){var t=[];return this.Qn.Vt((function(e,n){t.push(n)})),t},t}(),__PRIVATE_ViewSnapshot=function(){function t(t,e,n,r,i,s,o,u){this.query=t,this.docs=e,this.$n=n,this.docChanges=r,this.Yn=i,this.fromCache=s,this.Hn=o,this.Xn=u}return t.zn=function(e,n,r,i){var s=[];return n.forEach((function(t){s.push({type:__PRIVATE_ChangeType.Un,doc:t})})),new t(e,n,__PRIVATE_DocumentSet.Bn(n),s,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.Yn.tt()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Hn===t.Hn&&this.Yn.isEqual(t.Yn)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.$n.isEqual(t.$n)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),__PRIVATE_RemoteEvent=function(){function t(t,e,n,r,i){this.On=t,this.Jn=e,this.Zn=n,this.tr=r,this.er=i}return t.nr=function(e,n){var r,i=((r={})[e]=TargetChange.rr(e,n),r);return new t(__PRIVATE_SnapshotVersion.MIN,i,__PRIVATE_targetIdSet(),__PRIVATE_maybeDocumentMap(),__PRIVATE_documentKeySet())},t}(),TargetChange=function(){function t(t,e,n,r,i){this.resumeToken=t,this.ir=e,this.sr=n,this.or=r,this.ur=i}return t.rr=function(e,n){return new t(__PRIVATE_emptyByteString(),n,__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet())},t}(),__PRIVATE_DocumentWatchChange=function(t,e,n,r){this.ar=t,this.removedTargetIds=e,this.key=n,this._r=r},__PRIVATE_ExistenceFilterChange=function(t,e){this.targetId=t,this.cr=e};!function(t){t[t.hr=0]="__PRIVATE_NoChange",t[t.Un=1]="__PRIVATE_Added",t[t.kn=2]="__PRIVATE_Removed",t[t.lr=3]="__PRIVATE_Current",t[t.dr=4]="__PRIVATE_Reset"}(__PRIVATE_WatchTargetChangeState||(__PRIVATE_WatchTargetChangeState={}));var __PRIVATE_WatchTargetChange=function(t,e,n,r){void 0===n&&(n=__PRIVATE_emptyByteString()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},__PRIVATE_TargetState=function(){function t(){this.Tr=0,this.Er=__PRIVATE_snapshotChangesMap(),this.Pr=__PRIVATE_emptyByteString(),this.Ar=!1,this.Rr=!0}return Object.defineProperty(t.prototype,"ir",{get:function(){return this.Ar},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.Pr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Ir",{get:function(){return 0!==this.Tr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Vr",{get:function(){return this.Rr},enumerable:!0,configurable:!0}),t.prototype.mr=function(t){t.length>0&&(this.Rr=!0,this.Pr=t)},t.prototype.vr=function(){var t=__PRIVATE_documentKeySet(),e=__PRIVATE_documentKeySet(),n=__PRIVATE_documentKeySet();return this.Er.forEach((function(r,i){switch(i){case __PRIVATE_ChangeType.Un:t=t.add(r);break;case __PRIVATE_ChangeType.xn:e=e.add(r);break;case __PRIVATE_ChangeType.kn:n=n.add(r);break;default:fail("Encountered invalid change type: "+i)}})),new TargetChange(this.Pr,this.Ar,t,e,n)},t.prototype.pr=function(){this.Rr=!1,this.Er=__PRIVATE_snapshotChangesMap()},t.prototype.br=function(t,e){this.Rr=!0,this.Er=this.Er.Pt(t,e)},t.prototype.gr=function(t){this.Rr=!0,this.Er=this.Er.remove(t)},t.prototype.wr=function(){this.Tr+=1},t.prototype.yr=function(){this.Tr-=1},t.prototype.Sr=function(){this.Rr=!0,this.Ar=!0},t}(),__PRIVATE_LOG_TAG="WatchChangeAggregator",__PRIVATE_WatchChangeAggregator=function(){function t(t){this.Dr=t,this.Cr={},this.Or=__PRIVATE_maybeDocumentMap(),this.Fr=__PRIVATE_documentTargetMap(),this.Nr=new __PRIVATE_SortedSet(__PRIVATE_primitiveComparator)}return t.prototype.Mr=function(t){for(var e=0,n=t.ar;e<n.length;e++){var r=n[e];t._r instanceof Document?this.Lr(r,t._r):t._r instanceof __PRIVATE_NoDocument&&this.Gr(r,t.key,t._r)}for(var i=0,s=t.removedTargetIds;i<s.length;i++){r=s[i];this.Gr(r,t.key,t._r)}},t.prototype.Br=function(t){var e=this;this.Ur(t,(function(n){var r=e.kr(n);switch(t.state){case __PRIVATE_WatchTargetChangeState.hr:e.xr(n)&&r.mr(t.resumeToken);break;case __PRIVATE_WatchTargetChangeState.Un:r.yr(),r.Ir||r.pr(),r.mr(t.resumeToken);break;case __PRIVATE_WatchTargetChangeState.kn:r.yr(),r.Ir||e.removeTarget(n),assert(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case __PRIVATE_WatchTargetChangeState.lr:e.xr(n)&&(r.Sr(),r.mr(t.resumeToken));break;case __PRIVATE_WatchTargetChangeState.dr:e.xr(n)&&(e.Kr(n),r.mr(t.resumeToken));break;default:fail("Unknown target watch change state: "+t.state)}}))},t.prototype.Ur=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):__PRIVATE_forEachNumber(this.Cr,e)},t.prototype.jr=function(t){var e=t.targetId,n=t.cr.count,r=this.qr(e);if(r){var i=r.target;if(i.He())if(0===n){var s=new __PRIVATE_DocumentKey(i.path);this.Gr(e,s,new __PRIVATE_NoDocument(s,__PRIVATE_SnapshotVersion.W()))}else assert(1===n,"Single document existence filter with count: "+n);else this.Qr(e)!==n&&(this.Kr(e),this.Nr=this.Nr.add(e))}},t.prototype.Wr=function(t){var e=this,n={};__PRIVATE_forEachNumber(this.Cr,(function(r,i){var s=e.qr(r);if(s){if(i.ir&&s.target.He()){var o=new __PRIVATE_DocumentKey(s.target.path);null!==e.Or.get(o)||e.$r(r,o)||e.Gr(r,o,new __PRIVATE_NoDocument(o,t))}i.Vr&&(n[r]=i.vr(),i.pr())}}));var r=__PRIVATE_documentKeySet();this.Fr.forEach((function(t,n){var i=!0;n.Qt((function(t){var n=e.qr(t);return!n||n.Cn===__PRIVATE_TargetPurpose.Dn||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new __PRIVATE_RemoteEvent(t,n,this.Nr,this.Or,r);return this.Or=__PRIVATE_maybeDocumentMap(),this.Fr=__PRIVATE_documentTargetMap(),this.Nr=new __PRIVATE_SortedSet(__PRIVATE_primitiveComparator),i},t.prototype.Lr=function(t,e){if(this.xr(t)){var n=this.$r(t,e.key)?__PRIVATE_ChangeType.xn:__PRIVATE_ChangeType.Un;this.kr(t).br(e.key,n),this.Or=this.Or.Pt(e.key,e),this.Fr=this.Fr.Pt(e.key,this.Yr(e.key).add(t))}},t.prototype.Gr=function(t,e,n){if(this.xr(t)){var r=this.kr(t);this.$r(t,e)?r.br(e,__PRIVATE_ChangeType.kn):r.gr(e),this.Fr=this.Fr.Pt(e,this.Yr(e).delete(t)),n&&(this.Or=this.Or.Pt(e,n))}},t.prototype.removeTarget=function(t){delete this.Cr[t]},t.prototype.Qr=function(t){var e=this.kr(t).vr();return this.Dr.Hr(t).size+e.sr.size-e.ur.size},t.prototype.wr=function(t){this.kr(t).wr()},t.prototype.kr=function(t){return this.Cr[t]||(this.Cr[t]=new __PRIVATE_TargetState),this.Cr[t]},t.prototype.Yr=function(t){var e=this.Fr.get(t);return e||(e=new __PRIVATE_SortedSet(__PRIVATE_primitiveComparator),this.Fr=this.Fr.Pt(t,e)),e},t.prototype.xr=function(t){var e=null!==this.qr(t);return e||debug(__PRIVATE_LOG_TAG,"Detected inactive target",t),e},t.prototype.qr=function(t){var e=this.Cr[t];return e&&e.Ir?null:this.Dr.Xr(t)},t.prototype.Kr=function(t){var e=this;assert(!this.Cr[t].Ir,"Should only reset active targets"),this.Cr[t]=new __PRIVATE_TargetState,this.Dr.Hr(t).forEach((function(n){e.Gr(t,n,null)}))},t.prototype.$r=function(t,e){return this.Dr.Hr(t).has(e)},t}();function __PRIVATE_documentTargetMap(){return new __PRIVATE_SortedMap(__PRIVATE_DocumentKey.H)}function __PRIVATE_snapshotChangesMap(){return new __PRIVATE_SortedMap(__PRIVATE_DocumentKey.H)}var __PRIVATE_DIRECTIONS=function(){var t={};return t[__PRIVATE_Direction.ASCENDING.name]="ASCENDING",t[__PRIVATE_Direction.DESCENDING.name]="DESCENDING",t}(),__PRIVATE_OPERATORS=function(){var t={};return t[__PRIVATE_Operator.LESS_THAN.name]="LESS_THAN",t[__PRIVATE_Operator.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",t[__PRIVATE_Operator.GREATER_THAN.name]="GREATER_THAN",t[__PRIVATE_Operator.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",t[__PRIVATE_Operator.EQUAL.name]="EQUAL",t[__PRIVATE_Operator.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",t[__PRIVATE_Operator.IN.name]="IN",t[__PRIVATE_Operator.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",t}(),__PRIVATE_ISO_REG_EXP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function __PRIVATE_assertPresent(t,e){assert(!isNullOrUndefined(t),e+" is missing")}function __PRIVATE_parseInt64(t){return"number"==typeof t?t:"string"==typeof t?Number(t):fail("can't parse "+t)}var __PRIVATE_JsonProtoSerializer=function(){function t(t,e){this.o=t,this.options=e}return t.prototype.zr=function(){return this.options.Jr?"":new Uint8Array(0)},t.prototype.Zr=function(t){return t},t.prototype.ti=function(t){var e=void 0===t.code?Code.UNKNOWN:__PRIVATE_mapCodeFromRpcCode(t.code);return new FirestoreError(e,t.message||"")},t.prototype.ei=function(t){return this.options.Jr||isNullOrUndefined(t)?t:{value:t}},t.prototype.ni=function(t){var e;return isNullOrUndefined(e="object"==typeof t?t.value:t)?null:e},t.prototype.Y=function(t){return this.options.Jr?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},t.prototype.q=function(t){if("string"==typeof t)return this.ri(t);assert(!!t,"Cannot deserialize null or undefined timestamp.");var e=__PRIVATE_parseInt64(t.seconds||"0"),n=t.nanos||0;return new Timestamp(e,n)},t.prototype.ri=function(t){var e=0,n=__PRIVATE_ISO_REG_EXP.exec(t);if(assert(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),s=Math.floor(i.getTime()/1e3);return new Timestamp(s,e)},t.prototype.ii=function(t){return this.options.Jr?t.toBase64():this.Zr(t.toUint8Array())},t.prototype.si=function(t){return"string"==typeof t?(assert(this.options.Jr,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Blob.fromBase64String(t)):(assert(!this.options.Jr,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Blob.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.Y(t.Y())},t.prototype.fromVersion=function(t){return assert(!!t,"Trying to deserialize version that isn't set"),__PRIVATE_SnapshotVersion.q(this.q(t))},t.prototype.oi=function(t,e){return this.ui(t).child("documents").child(e).ot()},t.prototype.ai=function(t){var e=ResourcePath.ut(t);return assert(this._i(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.ci=function(t){return this.oi(this.o,t.path)},t.prototype.hi=function(t){var e=this.ai(t);return assert(e.get(1)===this.o.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.o.projectId),assert(!e.get(3)&&!this.o.database||e.get(3)===this.o.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.o.database),new __PRIVATE_DocumentKey(this.fi(e))},t.prototype.li=function(t){return this.oi(this.o,t)},t.prototype.di=function(t){var e=this.ai(t);return 4===e.length?ResourcePath.at:this.fi(e)},Object.defineProperty(t.prototype,"Ti",{get:function(){return new ResourcePath(["projects",this.o.projectId,"databases",this.o.database]).ot()},enumerable:!0,configurable:!0}),t.prototype.ui=function(t){return new ResourcePath(["projects",t.projectId,"databases",t.database])},t.prototype.fi=function(t){return assert(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.J(5)},t.prototype._i=function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.Ei=function(t){if(t instanceof __PRIVATE_NullValue)return{nullValue:"NULL_VALUE"};if(t instanceof __PRIVATE_BooleanValue)return{booleanValue:t.value()};if(t instanceof __PRIVATE_IntegerValue)return{integerValue:""+t.value()};if(t instanceof __PRIVATE_DoubleValue){var e=t.value();if(this.options.Jr){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof __PRIVATE_StringValue?{stringValue:t.value()}:t instanceof __PRIVATE_ObjectValue?{mapValue:this.Pi(t)}:t instanceof ArrayValue?{arrayValue:this.Ai(t)}:t instanceof __PRIVATE_TimestampValue?{timestampValue:this.Y(t.Zt)}:t instanceof __PRIVATE_GeoPointValue?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof __PRIVATE_BlobValue?{bytesValue:this.ii(t.value())}:t instanceof __PRIVATE_RefValue?{referenceValue:this.oi(t.o,t.key.path)}:fail("Unknown FieldValue "+JSON.stringify(t))},t.prototype.Ri=function(t){var e=this;if("nullValue"in t)return __PRIVATE_NullValue.Le;if("booleanValue"in t)return __PRIVATE_BooleanValue.of(t.booleanValue);if("integerValue"in t)return new __PRIVATE_IntegerValue(__PRIVATE_parseInt64(t.integerValue));if("doubleValue"in t){if(this.options.Jr){if("NaN"===t.doubleValue)return __PRIVATE_DoubleValue.Ue;if("Infinity"===t.doubleValue)return __PRIVATE_DoubleValue.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return __PRIVATE_DoubleValue.NEGATIVE_INFINITY}return new __PRIVATE_DoubleValue(t.doubleValue)}if("stringValue"in t)return new __PRIVATE_StringValue(t.stringValue);if("mapValue"in t)return this.Ii(t.mapValue.fields||{});if("arrayValue"in t){__PRIVATE_assertPresent(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new ArrayValue(n.map((function(t){return e.Ri(t)})))}if("timestampValue"in t)return __PRIVATE_assertPresent(t.timestampValue,"timestampValue"),new __PRIVATE_TimestampValue(this.q(t.timestampValue));if("geoPointValue"in t){__PRIVATE_assertPresent(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new __PRIVATE_GeoPointValue(new GeoPoint(r,i))}if("bytesValue"in t){__PRIVATE_assertPresent(t.bytesValue,"bytesValue");var s=this.si(t.bytesValue);return new __PRIVATE_BlobValue(s)}if("referenceValue"in t){__PRIVATE_assertPresent(t.referenceValue,"referenceValue");var o=this.ai(t.referenceValue),u=new __PRIVATE_DatabaseId(o.get(1),o.get(3)),a=new __PRIVATE_DocumentKey(this.fi(o));return new __PRIVATE_RefValue(u,a)}return fail("Unknown Value proto "+JSON.stringify(t))},t.prototype.Vi=function(t,e){return{name:this.ci(t),fields:this.mi(e)}},t.prototype.vi=function(t){return assert(!t.ce,"Can't serialize documents with mutations."),{name:this.ci(t.key),fields:this.mi(t.data()),updateTime:this.Y(t.version.Y())}},t.prototype.pi=function(t,e){var n=this,r=this.hi(t.name),i=this.fromVersion(t.updateTime);return new Document(r,i,{hasCommittedMutations:!!e},void 0,t,(function(t){return n.Ri(t)}))},t.prototype.mi=function(t){var e=this,n={};return t.forEach((function(t,r){n[t]=e.Ei(r)})),n},t.prototype.Ii=function(t){var e=this,n=t,r=__PRIVATE_ObjectValue.EMPTY;return forEach(n,(function(t,n){r=r.set(new FieldPath([t]),e.Ri(n))})),r},t.prototype.Pi=function(t){return{fields:this.mi(t)}},t.prototype.Ai=function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.Ei(t))})),{values:n}},t.prototype.bi=function(t){var e=this;assert(!!t.found,"Tried to deserialize a found document from a missing document."),__PRIVATE_assertPresent(t.found.name,"doc.found.name"),__PRIVATE_assertPresent(t.found.updateTime,"doc.found.updateTime");var n=this.hi(t.found.name),r=this.fromVersion(t.found.updateTime);return new Document(n,r,{},void 0,t.found,(function(t){return e.Ri(t)}))},t.prototype.gi=function(t){assert(!!t.missing,"Tried to deserialize a missing document from a found document."),assert(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.hi(t.missing),n=this.fromVersion(t.readTime);return new __PRIVATE_NoDocument(e,n)},t.prototype.wi=function(t){return"found"in t?this.bi(t):"missing"in t?this.gi(t):fail("invalid batch get response: "+JSON.stringify(t))},t.prototype.yi=function(t){switch(t){case __PRIVATE_WatchTargetChangeState.Un:return"ADD";case __PRIVATE_WatchTargetChangeState.lr:return"CURRENT";case __PRIVATE_WatchTargetChangeState.hr:return"NO_CHANGE";case __PRIVATE_WatchTargetChangeState.kn:return"REMOVE";case __PRIVATE_WatchTargetChangeState.dr:return"RESET";default:return fail("Unknown WatchTargetChangeState: "+t)}},t.prototype.Si=function(t){if(t instanceof __PRIVATE_ExistenceFilterChange)return{filter:{count:t.cr.count,targetId:t.targetId}};if(t instanceof __PRIVATE_DocumentWatchChange){if(t._r instanceof Document){var e=t._r;return{documentChange:{document:{name:this.ci(e.key),fields:this.mi(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.ar,removedTargetIds:t.removedTargetIds}}}if(t._r instanceof __PRIVATE_NoDocument){e=t._r;return{documentDelete:{document:this.ci(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}}}if(null===t._r)return{documentRemove:{document:this.ci(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof __PRIVATE_WatchTargetChange){var n=void 0;return t.cause&&(n={code:__PRIVATE_mapRpcCodeFromCode(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.yi(t.state),targetIds:t.targetIds,resumeToken:this.Zr(t.resumeToken),cause:n}}}return fail("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.Di=function(t){var e,n=this;if("targetChange"in t){__PRIVATE_assertPresent(t.targetChange,"targetChange");var r=this.Ci(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=t.targetChange.resumeToken||this.zr(),o=t.targetChange.cause,u=o&&this.ti(o);e=new __PRIVATE_WatchTargetChange(r,i,s,u||null)}else if("documentChange"in t){__PRIVATE_assertPresent(t.documentChange,"documentChange");var a=t.documentChange;__PRIVATE_assertPresent(a.document,"documentChange.name"),__PRIVATE_assertPresent(a.document.name,"documentChange.document.name"),__PRIVATE_assertPresent(a.document.updateTime,"documentChange.document.updateTime");var _=this.hi(a.document.name),c=this.fromVersion(a.document.updateTime),h=new Document(_,c,{},void 0,a.document,(function(t){return n.Ri(t)})),f=a.targetIds||[],l=a.removedTargetIds||[];e=new __PRIVATE_DocumentWatchChange(f,l,h.key,h)}else if("documentDelete"in t){__PRIVATE_assertPresent(t.documentDelete,"documentDelete");var d=t.documentDelete;__PRIVATE_assertPresent(d.document,"documentDelete.document");_=this.hi(d.document),c=d.readTime?this.fromVersion(d.readTime):__PRIVATE_SnapshotVersion.W(),h=new __PRIVATE_NoDocument(_,c),l=d.removedTargetIds||[];e=new __PRIVATE_DocumentWatchChange([],l,h.key,h)}else if("documentRemove"in t){__PRIVATE_assertPresent(t.documentRemove,"documentRemove");var T=t.documentRemove;__PRIVATE_assertPresent(T.document,"documentRemove");_=this.hi(T.document),l=T.removedTargetIds||[];e=new __PRIVATE_DocumentWatchChange([],l,_,null)}else{if(!("filter"in t))return fail("Unknown change type "+JSON.stringify(t));__PRIVATE_assertPresent(t.filter,"filter");var E=t.filter;__PRIVATE_assertPresent(E.targetId,"filter.targetId");var P=E.count||0,A=new ExistenceFilter(P),R=E.targetId;e=new __PRIVATE_ExistenceFilterChange(R,A)}return e},t.prototype.Ci=function(t){return"NO_CHANGE"===t?__PRIVATE_WatchTargetChangeState.hr:"ADD"===t?__PRIVATE_WatchTargetChangeState.Un:"REMOVE"===t?__PRIVATE_WatchTargetChangeState.kn:"CURRENT"===t?__PRIVATE_WatchTargetChangeState.lr:"RESET"===t?__PRIVATE_WatchTargetChangeState.dr:fail("Got unexpected TargetChange.state: "+t)},t.prototype.Oi=function(t){if(!("targetChange"in t))return __PRIVATE_SnapshotVersion.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?__PRIVATE_SnapshotVersion.MIN:e.readTime?this.fromVersion(e.readTime):__PRIVATE_SnapshotVersion.MIN},t.prototype.Fi=function(t){var e,n=this;if(t instanceof __PRIVATE_SetMutation)e={update:this.Vi(t.key,t.value)};else if(t instanceof __PRIVATE_DeleteMutation)e={delete:this.ci(t.key)};else if(t instanceof __PRIVATE_PatchMutation)e={update:this.Vi(t.key,t.data),updateMask:this.Ni(t.fe)};else if(t instanceof __PRIVATE_TransformMutation)e={transform:{document:this.ci(t.key),fieldTransforms:t.fieldTransforms.map((function(t){return n.Mi(t)}))}};else{if(!(t instanceof __PRIVATE_VerifyMutation))return fail("Unknown mutation type "+t.type);e={verify:this.ci(t.key)}}return t._e.se||(e.currentDocument=this.Li(t._e)),e},t.prototype.Gi=function(t){var e=this,n=t.currentDocument?this.Bi(t.currentDocument):Precondition.NONE;if(t.update){__PRIVATE_assertPresent(t.update.name,"name");var r=this.hi(t.update.name),i=this.Ii(t.update.fields||{});if(t.updateMask){var s=this.Ui(t.updateMask);return new __PRIVATE_PatchMutation(r,i,s,n)}return new __PRIVATE_SetMutation(r,i,n)}if(t.delete){r=this.hi(t.delete);return new __PRIVATE_DeleteMutation(r,n)}if(t.transform){r=this.hi(t.transform.document);var o=t.transform.fieldTransforms.map((function(t){return e.ki(t)}));return assert(!0===n.exists,'Transforms only support precondition "exists == true"'),new __PRIVATE_TransformMutation(r,o)}if(t.verify){r=this.hi(t.verify);return new __PRIVATE_VerifyMutation(r,n)}return fail("unknown mutation proto: "+JSON.stringify(t))},t.prototype.Li=function(t){return assert(!t.se,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:fail("Unknown precondition")},t.prototype.Bi=function(t){return void 0!==t.updateTime?Precondition.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Precondition.exists(t.exists):Precondition.NONE},t.prototype.xi=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(__PRIVATE_SnapshotVersion.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&t.transformResults.length>0&&(i=t.transformResults.map((function(t){return n.Ri(t)}))),new __PRIVATE_MutationResult(r,i)},t.prototype.Ki=function(t,e){var n=this;return t&&t.length>0?(assert(void 0!==e,"Received a write result without a commit time"),t.map((function(t){return n.xi(t,e)}))):[]},t.prototype.Mi=function(t){var e=this,n=t.transform;if(n instanceof __PRIVATE_ServerTimestampTransform)return{fieldPath:t.field.ot(),setToServerValue:"REQUEST_TIME"};if(n instanceof __PRIVATE_ArrayUnionTransformOperation)return{fieldPath:t.field.ot(),appendMissingElements:{values:n.elements.map((function(t){return e.Ei(t)}))}};if(n instanceof __PRIVATE_ArrayRemoveTransformOperation)return{fieldPath:t.field.ot(),removeAllFromArray:{values:n.elements.map((function(t){return e.Ei(t)}))}};if(n instanceof __PRIVATE_NumericIncrementTransformOperation)return{fieldPath:t.field.ot(),increment:this.Ei(n.Jt)};throw fail("Unknown transform: "+t.transform)},t.prototype.ki=function(t){var e=this,n=null;if("setToServerValue"in t)assert("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=__PRIVATE_ServerTimestampTransform.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new __PRIVATE_ArrayUnionTransformOperation(r.map((function(t){return e.Ri(t)})))}else if("removeAllFromArray"in t){r=t.removeAllFromArray.values||[];n=new __PRIVATE_ArrayRemoveTransformOperation(r.map((function(t){return e.Ri(t)})))}else if("increment"in t){var i=this.Ri(t.increment);assert(i instanceof __PRIVATE_NumberValue,"NUMERIC_ADD transform requires a NumberValue"),n=new __PRIVATE_NumericIncrementTransformOperation(i)}else fail("Unknown transform proto: "+JSON.stringify(t));var s=FieldPath.ft(t.fieldPath);return new FieldTransform(s,n)},t.prototype.ji=function(t){return{documents:[this.li(t.path)]}},t.prototype.qi=function(t){var e=t.documents.length;assert(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return Query.rn(this.di(n)).Tn()},t.prototype.Qi=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(assert(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.li(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(assert(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.li(n.Z()),e.structuredQuery.from=[{collectionId:n.nt()}]);var r=this.Wi(t.filters);r&&(e.structuredQuery.where=r);var i=this.$i(t.orderBy);i&&(e.structuredQuery.orderBy=i);var s=this.ei(t.limit);return null!==s&&(e.structuredQuery.limit=s),t.startAt&&(e.structuredQuery.startAt=this.Yi(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Yi(t.endAt)),e},t.prototype.Hi=function(t){var e=this.di(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){assert(1===r,"StructuredQuery.from with more than one collection is not supported.");var s=n.from[0];s.allDescendants?i=s.collectionId:e=e.child(s.collectionId)}var o=[];n.where&&(o=this.Xi(n.where));var u=[];n.orderBy&&(u=this.zi(n.orderBy));var a=null;n.limit&&(a=this.ni(n.limit));var _=null;n.startAt&&(_=this.Ji(n.startAt));var c=null;return n.endAt&&(c=this.Ji(n.endAt)),new Query(e,i,u,o,a,__PRIVATE_LimitType.Xe,_,c).Tn()},t.prototype.Zi=function(t){var e=this.ts(t.Cn);return null==e?null:{"goog-listen-tags":e}},t.prototype.ts=function(t){switch(t){case __PRIVATE_TargetPurpose.yn:return null;case __PRIVATE_TargetPurpose.Sn:return"existence-filter-mismatch";case __PRIVATE_TargetPurpose.Dn:return"limbo-document";default:return fail("Unrecognized query purpose: "+t)}},t.prototype.Tn=function(t){var e,n=t.target;return(e=n.He()?{documents:this.ji(n)}:{query:this.Qi(n)}).targetId=t.targetId,t.resumeToken.length>0&&(e.resumeToken=this.Zr(t.resumeToken)),e},t.prototype.Wi=function(t){var e=this;if(0!==t.length){var n=t.map((function(t){return t instanceof FieldFilter?e.es(t):fail("Unrecognized filter: "+JSON.stringify(t))}));return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.Xi=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.ns(t)]:void 0!==t.fieldFilter?[this.rs(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return e.Xi(t)})).reduce((function(t,e){return t.concat(e)})):fail("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.$i=function(t){var e=this;if(0!==t.length)return t.map((function(t){return e.ss(t)}))},t.prototype.zi=function(t){var e=this;return t.map((function(t){return e.os(t)}))},t.prototype.Yi=function(t){var e=this;return{before:t.before,values:t.position.map((function(t){return e.Ei(t)}))}},t.prototype.Ji=function(t){var e=this,n=!!t.before,r=t.values.map((function(t){return e.Ri(t)}));return new __PRIVATE_Bound(r,n)},t.prototype.us=function(t){return __PRIVATE_DIRECTIONS[t.name]},t.prototype.as=function(t){switch(t){case"ASCENDING":return __PRIVATE_Direction.ASCENDING;case"DESCENDING":return __PRIVATE_Direction.DESCENDING;default:return}},t.prototype._s=function(t){return __PRIVATE_OPERATORS[t.name]},t.prototype.cs=function(t){switch(t){case"EQUAL":return __PRIVATE_Operator.EQUAL;case"GREATER_THAN":return __PRIVATE_Operator.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return __PRIVATE_Operator.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return __PRIVATE_Operator.LESS_THAN;case"LESS_THAN_OR_EQUAL":return __PRIVATE_Operator.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return __PRIVATE_Operator.ARRAY_CONTAINS;case"IN":return __PRIVATE_Operator.IN;case"ARRAY_CONTAINS_ANY":return __PRIVATE_Operator.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return fail("Unspecified operator");default:return fail("Unknown operator")}},t.prototype.hs=function(t){return{fieldPath:t.ot()}},t.prototype.fs=function(t){return FieldPath.ft(t.fieldPath)},t.prototype.ss=function(t){return{field:this.hs(t.field),direction:this.us(t.dir)}},t.prototype.os=function(t){return new __PRIVATE_OrderBy(this.fs(t.field),this.as(t.direction))},t.prototype.rs=function(t){return FieldFilter.create(this.fs(t.fieldFilter.field),this.cs(t.fieldFilter.op),this.Ri(t.fieldFilter.value))},t.prototype.es=function(t){if(t.op===__PRIVATE_Operator.EQUAL){if(t.value.isEqual(__PRIVATE_DoubleValue.Ue))return{unaryFilter:{field:this.hs(t.field),op:"IS_NAN"}};if(t.value.isEqual(__PRIVATE_NullValue.Le))return{unaryFilter:{field:this.hs(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.hs(t.field),op:this._s(t.op),value:this.Ei(t.value)}}},t.prototype.ns=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fs(t.unaryFilter.field);return FieldFilter.create(e,__PRIVATE_Operator.EQUAL,__PRIVATE_DoubleValue.Ue);case"IS_NULL":var n=this.fs(t.unaryFilter.field);return FieldFilter.create(n,__PRIVATE_Operator.EQUAL,__PRIVATE_NullValue.Le);case"OPERATOR_UNSPECIFIED":return fail("Unspecified filter");default:return fail("Unknown filter")}},t.prototype.Ni=function(t){var e=[];return t.fields.forEach((function(t){return e.push(t.ot())})),{fieldPaths:e}},t.prototype.Ui=function(t){var e=(t.fieldPaths||[]).map((function(t){return FieldPath.ft(t)}));return __PRIVATE_FieldMask.ee(e)},t}(),__PRIVATE_PlatformSupport=function(){function t(){}return t.ls=function(e){t.platform&&fail("Platform already defined"),t.platform=e},t.t=function(){return t.platform||fail("Platform not set"),t.platform},t}();function __PRIVATE_emptyByteString(){return __PRIVATE_PlatformSupport.t().zr}function __PRIVATE_makeConstructorPrivate(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new FirestoreError(Code.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function __PRIVATE_assertUint8ArrayAvailable(){if("undefined"==typeof Uint8Array)throw new FirestoreError(Code.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function __PRIVATE_assertBase64Available(){if(!__PRIVATE_PlatformSupport.t().ds)throw new FirestoreError(Code.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var __PRIVATE_TimerId,Blob=function(){function t(t){__PRIVATE_assertBase64Available(),this.Ts=t}return t.fromBase64String=function(e){__PRIVATE_validateExactNumberOfArgs("Blob.fromBase64String",arguments,1),__PRIVATE_validateArgType("Blob.fromBase64String","string",1,e),__PRIVATE_assertBase64Available();try{var n=__PRIVATE_PlatformSupport.t().atob(e);return new t(n)}catch(t){throw new FirestoreError(Code.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},t.fromUint8Array=function(e){if(__PRIVATE_validateExactNumberOfArgs("Blob.fromUint8Array",arguments,1),__PRIVATE_assertUint8ArrayAvailable(),!(e instanceof Uint8Array))throw __PRIVATE_invalidClassError("Blob.fromUint8Array","Uint8Array",1,e);var n=Array.prototype.map.call(e,(function(t){return String.fromCharCode(t)})).join("");return new t(n)},t.prototype.toBase64=function(){return __PRIVATE_validateExactNumberOfArgs("Blob.toBase64",arguments,0),__PRIVATE_assertBase64Available(),__PRIVATE_PlatformSupport.t().btoa(this.Ts)},t.prototype.toUint8Array=function(){__PRIVATE_validateExactNumberOfArgs("Blob.toUint8Array",arguments,0),__PRIVATE_assertUint8ArrayAvailable();for(var t=new Uint8Array(this.Ts.length),e=0;e<this.Ts.length;e++)t[e]=this.Ts.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.Ts===t.Ts},t.prototype.xe=function(){return 2*this.Ts.length},t.prototype.K=function(t){return __PRIVATE_primitiveComparator(this.Ts,t.Ts)},t}(),__PRIVATE_PublicBlob=__PRIVATE_makeConstructorPrivate(Blob,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),__PRIVATE_ListenSequence=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.Es=function(t){return n.Ps(t)},this.As=function(t){return e.Rs(t)})}return t.prototype.Ps=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.As&&this.As(t),t},t.Is=-1,t}(),__PRIVATE_Deferred=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))};!function(t){t.Vs="all",t.ms="listen_strea